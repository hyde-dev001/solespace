# Comprehensive Troubleshooting Guide

## Common Issues & Solutions

### Installation Issues

#### 1. npm install Failing with Peer Dependency Errors

**Problem:**
```
npm ERR! code ERESOLVE
npm ERR! ERESOLVE unable to resolve dependency tree
```

**Solutions:**

Option 1 - Use Legacy Peer Deps (Recommended for this project):
```bash
npm install --legacy-peer-deps
```

Option 2 - Force Installation:
```bash
npm install --force
```

Option 3 - Clean and Reinstall:
```bash
rm -rf node_modules package-lock.json
npm install --legacy-peer-deps
```

Option 4 - Update npm:
```bash
npm install -g npm@latest
npm install --legacy-peer-deps
```

---

#### 2. Composer Install Timing Out

**Problem:**
```
The connection attempt failed. Connection timed out
```

**Solutions:**

Option 1 - Increase Timeout:
```bash
composer install --verbose --no-interaction
```

Option 2 - Use Different Repository:
```bash
composer config repo.packagist composer https://repo.packagist.org
composer install
```

Option 3 - Clear Cache and Retry:
```bash
composer clear-cache
composer install
```

Option 4 - Use Snapshot:
```bash
composer install --prefer-dist --no-interaction
```

---

#### 3. PHP Version Mismatch

**Problem:**
```
PHP Fatal error: ... requires php >=8.2.0
```

**Solutions:**

Check current version:
```bash
php --version
```

**For Windows (XAMPP):**
1. Download XAMPP with PHP 8.2+
2. Or download standalone PHP 8.2: https://windows.php.net/download/
3. Update PATH in Environment Variables

**For macOS:**
```bash
brew install php@8.2
brew link php@8.2
```

**For Linux:**
```bash
sudo apt-get install php8.2 php8.2-mysql php8.2-curl
sudo update-alternatives --set php /usr/bin/php8.2
```

---

#### 4. Extension Not Found Errors

**Problem:**
```
PHP Fatal error: Call to undefined function json_encode()
PHP Fatal error: PDOException: could not find driver
```

**Solutions:**

Check available extensions:
```bash
php -m
```

**For XAMPP (Windows):**
1. Open `C:\xampp\php\php.ini`
2. Find line like `;extension=mysql`
3. Remove the `;` at the beginning: `extension=mysql`
4. Required extensions:
   - extension=json
   - extension=pdo
   - extension=pdo_mysql
   - extension=curl
   - extension=xml
   - extension=mbstring
5. Restart Apache and MySQL

**For standalone PHP:**
Edit `php.ini` and ensure these are uncommented:
```
extension=json
extension=pdo_mysql
extension=curl
extension=xml
extension=mbstring
```

**For macOS:**
```bash
brew install php82-json php82-pdo php82-mysql php82-curl
```

---

### Development Server Issues

#### 5. Laravel Server Won't Start

**Problem:**
```
PHP Fatal error: Class 'App\Providers\AppServiceProvider' not found
```

**Solutions:**

Step 1 - Clear Laravel Cache:
```bash
php artisan cache:clear
php artisan config:clear
php artisan view:clear
php artisan route:clear
```

Step 2 - Regenerate App Key:
```bash
php artisan key:generate
```

Step 3 - Verify .env file:
```bash
# Ensure these exist:
APP_NAME=Solespace
APP_KEY=base64:xxxxxxxxxxxxx (generated by key:generate)
APP_DEBUG=true
APP_URL=http://localhost:8000
```

Step 4 - Run migrations:
```bash
php artisan migrate
```

Step 5 - Start server again:
```bash
php artisan serve --host=127.0.0.1 --port=8000
```

---

#### 6. Vite Dev Server Not Starting

**Problem:**
```
[error] Error: ENOENT: no such file or directory
```

**Solutions:**

Step 1 - Verify vite.config.ts exists:
```bash
ls -la vite.config.ts
```

Step 2 - Reinstall Vite:
```bash
npm install vite@latest @vitejs/plugin-react@latest --save-dev
```

Step 3 - Clear npm cache:
```bash
npm cache clean --force
```

Step 4 - Run with verbose output:
```bash
npm run dev -- --debug
```

Step 5 - Check for syntax errors in config:
```bash
node -c vite.config.ts
```

---

#### 7. Port Already in Use

**Problem:**
```
Port 8000 is already in use
Port 5173 is already in use
```

**Solutions:**

**For Windows:**
```powershell
# Find process using port 8000
netstat -ano | findstr :8000

# Kill process (replace PID with actual number)
taskkill /PID <PID> /F

# Alternative port:
php artisan serve --port=8001
npm run dev -- --port=5174
```

**For macOS/Linux:**
```bash
# Find process using port 8000
lsof -i :8000

# Kill process
kill -9 <PID>

# Alternative ports:
php artisan serve --port=8001
npm run dev -- --port=5174
```

---

### Database Issues

#### 8. Database Connection Failed

**Problem:**
```
SQLSTATE[HY000] [2002] No such file or directory
Database connection test failed
```

**Solutions:**

Step 1 - Verify MySQL is running:

**Windows:**
```powershell
# Check if MySQL is running
Get-Process | grep -i mysql

# Or start MySQL via XAMPP Control Panel
```

**macOS:**
```bash
# Check if MySQL is running
ps aux | grep mysql

# Start MySQL if stopped
brew services start mysql
```

**Linux:**
```bash
# Check MySQL status
sudo service mysql status

# Start MySQL if stopped
sudo service mysql start
```

Step 2 - Verify .env database settings:
```
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=solespace
DB_USERNAME=root
DB_PASSWORD=
```

Step 3 - Test MySQL connection:
```bash
# Windows/macOS/Linux
mysql -h 127.0.0.1 -u root -p

# If password, use: mysql -h 127.0.0.1 -u root -pYOURPASSWORD
```

Step 4 - Create database if missing:
```bash
php artisan migrate
```

---

#### 9. Database Does Not Exist

**Problem:**
```
SQLSTATE[HY000] [1049] Unknown database 'solespace'
```

**Solutions:**

**Option 1 - Using Command Line:**
```bash
# Login to MySQL
mysql -u root -p

# Create database
CREATE DATABASE solespace;
CREATE DATABASE solespace_test;

# Exit
exit
```

**Option 2 - Using Laravel:**
```bash
# Create database and run migrations
php artisan migrate:fresh

# Or with seeding
php artisan migrate:fresh --seed
```

**Option 3 - Using PhpMyAdmin (XAMPP):**
1. Open http://localhost/phpmyadmin
2. Click "New" on left sidebar
3. Database name: `solespace`
4. Click "Create"
5. Run migrations:
   ```bash
   php artisan migrate
   ```

---

#### 10. Migration Errors

**Problem:**
```
Base table or view already exists
SQLSTATE[HY000] [1050] Table 'users' already exists
```

**Solutions:**

Option 1 - Fresh migration (loses data):
```bash
php artisan migrate:fresh
```

Option 2 - Rollback and remigrate:
```bash
php artisan migrate:rollback
php artisan migrate
```

Option 3 - Reset database completely:
```bash
php artisan migrate:reset
php artisan migrate
```

---

### Frontend Issues

#### 11. React Component Not Rendering

**Problem:**
- Blank page
- No content displayed
- JavaScript errors in console

**Solutions:**

Step 1 - Check browser console for errors:
- Open DevTools (F12)
- Check Console tab
- Check Network tab (ensure CSS/JS loaded)

Step 2 - Verify Vite is running:
```bash
# Should show "VITE v7.3.1 ready in XXX ms"
npm run dev
```

Step 3 - Check Vite hot module replacement (HMR):
In `vite.config.ts`:
```typescript
server: {
  hmr: {
    host: 'localhost',
    port: 5173,
  },
},
```

Step 4 - Clear browser cache:
- Hard refresh: Ctrl+Shift+R (Windows) or Cmd+Shift+R (macOS)
- Or clear cache in DevTools

Step 5 - Check for React errors:
```bash
npm list react react-dom
```

---

#### 12. TypeScript Compilation Errors

**Problem:**
```
TS2307: Cannot find module '@/components/Header'
TS2322: Type 'string' is not assignable to type 'number'
```

**Solutions:**

Step 1 - Check paths in tsconfig.json:
```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  }
}
```

Step 2 - Verify file exists and is correctly imported:
```typescript
// Correct
import Header from '@/components/Header.tsx'

// Incorrect (missing .tsx)
import Header from '@/components/Header'
```

Step 3 - Run TypeScript compiler:
```bash
npx tsc --noEmit
```

Step 4 - Update type definitions:
```bash
npm install --save-dev @types/react@latest @types/react-dom@latest
```

---

#### 13. Tailwind CSS Not Working

**Problem:**
- Styles not applied
- Classes not recognized
- Colors not showing

**Solutions:**

Step 1 - Check tailwind.config.js:
```javascript
module.exports = {
  content: [
    './index.html',
    './src/**/*.{js,ts,jsx,tsx}',
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}
```

Step 2 - Verify PostCSS configuration:
```javascript
// postcss.config.js
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
```

Step 3 - Check CSS import in main file:
```typescript
// src/index.css or src/main.tsx
import './index.css'

// And index.css should contain:
@tailwind base;
@tailwind components;
@tailwind utilities;
```

Step 4 - Rebuild CSS:
```bash
npm run dev
```

---

### Authentication Issues

#### 14. Login Not Working / Session Issues

**Problem:**
- Login fails with no error
- Session not persisting
- Redirected to login after refresh

**Solutions:**

Step 1 - Verify session configuration in .env:
```
SESSION_DRIVER=database
SESSION_LIFETIME=525600
SESSION_DOMAIN=localhost
SESSION_SECURE_COOKIES=false
SESSION_HTTP_ONLY=true
SESSION_SAME_SITE=lax
```

Step 2 - Ensure sessions table exists:
```bash
php artisan session:table
php artisan migrate
```

Step 3 - Check Laravel logs:
```bash
tail -f storage/logs/laravel.log
```

Step 4 - Verify credentials in database:
```bash
php artisan tinker
> User::where('email', 'user@solespace.com')->first()
```

Step 5 - Clear session cache:
```bash
php artisan session:clear-expired
```

---

#### 15. "Unauthenticated" / 401 Errors

**Problem:**
```
The user is not authenticated
You are not authorized to access this resource
```

**Solutions:**

Step 1 - Verify you're logged in:
- Check browser cookies for session
- Check Storage tab in DevTools

Step 2 - Check middleware in routes:
```php
Route::middleware(['auth:user'])->group(function () {
    // Only authenticated users can access
});
```

Step 3 - Verify user role/guard:
```bash
php artisan tinker
> auth('user')->user()
> auth('shop_owner')->user()
> auth('super_admin')->user()
```

Step 4 - Check CSRF token:
Ensure CSRF token is included in POST requests:
```typescript
// In Inertia/React
<form method="POST">
  <input type="hidden" name="_token" value={csrf_token} />
</form>
```

---

### File Upload Issues

#### 16. File Upload Failing

**Problem:**
```
The file field is required
File size exceeds maximum allowed size
```

**Solutions:**

Step 1 - Check PHP file upload limits in php.ini:
```ini
upload_max_filesize = 2M
post_max_size = 8M
```

For XAMPP, edit: `C:\xampp\php\php.ini`

Step 2 - Create storage symlink:
```bash
# Windows (run as Administrator)
mklink /D public\storage storage\app\public

# macOS/Linux
ln -s storage/app/public public/storage
```

Step 3 - Verify storage directory permissions:
```bash
# Linux/macOS
chmod -R 755 storage
chmod -R 755 bootstrap/cache
```

Step 4 - Check Laravel storage config:
```php
// config/filesystems.php
'default' => 'public',
'disks' => [
    'public' => [
        'driver' => 'local',
        'path' => 'storage/app/public',
        'url' => env('APP_URL').'/storage',
    ],
]
```

Step 5 - Test file upload via Tinker:
```bash
php artisan tinker
> Storage::disk('public')->put('test.txt', 'Hello World')
```

---

### Performance Issues

#### 17. Slow Application Performance

**Problem:**
- Pages load slowly
- Database queries are slow
- Vite build takes too long

**Solutions:**

Step 1 - Check database queries:
Enable query logging in .env:
```
DB_LOG_QUERIES=true
```

Check logs: `storage/logs/laravel.log`

Step 2 - Optimize database:
```bash
# Add indexes to frequently queried columns
php artisan tinker
> // Run migrations with proper indexing
```

Step 3 - Enable caching:
```bash
php artisan config:cache
php artisan route:cache
php artisan view:cache
```

Step 4 - Check for N+1 queries:
Use `with()` for eager loading:
```php
User::with('shopDocuments')->get()
```

Step 5 - Profile Vite build:
```bash
npm run build -- --debug
```

---

#### 18. High Memory Usage

**Problem:**
```
PHP Fatal error: Allowed memory size exhausted
npm ERR! JavaScript heap out of memory
```

**Solutions:**

**For PHP:**
```bash
# Increase memory limit
php -d memory_limit=512M artisan serve

# Or set in php.ini:
memory_limit = 512M
```

**For npm:**
```bash
# Increase Node memory
npm install --max-old-space-size=4096
```

---

### CORS & Network Issues

#### 19. CORS Errors

**Problem:**
```
Access to XMLHttpRequest blocked by CORS policy
```

**Solutions:**

Step 1 - Check CORS configuration:
```php
// config/cors.php
'paths' => ['api/*', 'sanctum/csrf-cookie'],
'allowed_methods' => ['*'],
'allowed_origins' => ['localhost:5173'],
'supports_credentials' => true,
```

Step 2 - Verify Inertia setup:
In React, Inertia handles CORS automatically if Laravel is configured correctly.

Step 3 - Check middleware:
Ensure CORS middleware is registered in `app/Http/Kernel.php`:
```php
protected $middleware = [
    // ...
    \Fruitcake\Cors\HandleCors::class,
];
```

---

#### 20. Cannot Connect to Backend

**Problem:**
```
Network error: Failed to fetch
Cannot GET /
```

**Solutions:**

Step 1 - Verify Laravel server is running:
```bash
# You should see:
# Laravel development server started: http://127.0.0.1:8000
```

Step 2 - Check port configuration:
```bash
# Verify port 8000 is not in use
netstat -ano | findstr :8000  # Windows
lsof -i :8000                # macOS/Linux
```

Step 3 - Verify frontend is pointing to correct backend:
In Vite/React:
```typescript
// Ensure requests go to correct backend
axios.defaults.baseURL = 'http://localhost:8000'
```

Step 4 - Check firewall:
Ensure port 8000 is not blocked by firewall.

---

### Windows-Specific Issues

#### 21. "PHP is not recognized as an internal or external command"

**Problem:**
```
'php' is not recognized as an internal or external command
```

**Solutions:**

Step 1 - Check if PHP is installed:
```powershell
C:\xampp\php\php.exe --version
```

Step 2 - Add PHP to PATH:
1. Open "Environment Variables" (Windows Key + "env")
2. Click "Edit the system environment variables"
3. Click "Environment Variables"
4. Under "System variables", click "New"
5. Variable name: `PATH`
6. Variable value: `C:\xampp\php` (or wherever PHP is installed)
7. Click OK and restart Terminal

Step 3 - Verify PATH was updated:
```powershell
php --version
```

---

#### 22. "Composer is not found"

**Problem:**
```
'composer' is not recognized
```

**Solutions:**

Step 1 - Download Composer:
https://getcomposer.org/Composer-Setup.exe

Step 2 - Run installer (will add to PATH automatically)

Step 3 - Verify:
```powershell
composer --version
```

Step 4 - If still not found:
Add to PATH manually:
```
C:\Users\YourUsername\AppData\Roaming\Composer\vendor\bin
```

---

#### 23. Symbolic Link Error (Storage Symlink)

**Problem:**
```
Exception: Unable to create symbolic link [public/storage]: File exists
EEXIST: file already exists
```

**Solutions:**

Step 1 - Remove existing symlink or folder:
```powershell
rmdir public\storage
```

Step 2 - Run as Administrator:
```powershell
# Run PowerShell as Administrator
mklink /D public\storage storage\app\public
```

Step 3 - If still failing:
```powershell
# Manual approach - copy instead of symlink
xcopy storage\app\public public\storage /E /I /Y
```

---

### Debugging Tools

#### Enable Debug Mode

In `.env`:
```
APP_DEBUG=true
```

In browser:
- Open DevTools (F12)
- Check Console tab for errors
- Check Network tab for failed requests

---

#### View Laravel Logs

```bash
# Real-time log viewing
tail -f storage/logs/laravel.log

# Windows
Get-Content storage/logs/laravel.log -Wait
```

---

#### Use Laravel Tinker

```bash
php artisan tinker

# Then try:
> User::all()
> ShopOwner::find(1)
> DB::connection()->getSchemaBuilder()->hasTable('users')
> Auth::check()
```

---

#### Check Database Connection

```bash
php artisan tinker
> DB::connection()->getPDO()
// If connection successful, returns PDO object
```

---

### Getting Help

If you can't resolve an issue:

1. **Check Laravel Documentation:** https://laravel.com/docs/12.x
2. **Check React Documentation:** https://react.dev
3. **Search Stack Overflow:** https://stackoverflow.com/questions/tagged/laravel+react
4. **Check GitHub Issues:** Look for similar issues in Laravel/React repos
5. **Enable Debug Mode:** `APP_DEBUG=true` to see detailed error messages

---

## Verification Checklist After Troubleshooting

- [ ] PHP version is 8.2 or higher
- [ ] MySQL/MariaDB is running
- [ ] Database `solespace` exists
- [ ] All migrations have run (`php artisan migrate:status`)
- [ ] npm packages installed without major errors
- [ ] Composer packages installed
- [ ] `.env` file exists and properly configured
- [ ] `APP_KEY` is generated and unique
- [ ] Storage symlink created
- [ ] Laravel server starts without errors
- [ ] Vite dev server starts without errors
- [ ] Can login with test credentials
- [ ] Browser console has no errors
- [ ] All styles load correctly

---

**If problems persist, check the Laravel logs in `storage/logs/laravel.log` for detailed error messages.**
